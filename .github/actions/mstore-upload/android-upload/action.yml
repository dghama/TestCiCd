name: Upload APK version

inputs:
  AUTHORIZATION:
    description: 'Authorization token'
    required: true
  APP_DEV_TOKEN:
    description: 'Application dev token'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Debug file existence
      run: |
        echo "Checking for output.json file:"
        ls -l ${{env.ANDROID_BUILD_DIR}}
        cat ${{env.ANDROID_INFO_FILE}}
      shell: bash

    - name: Set permissions
      run: |
        chmod 644 ${{env.ANDROID_INFO_FILE}}
        chmod 644 ${{env.ANDROID_BUILD_FILE}}
      shell: bash

    - name: Upload the application on Mstore
      run: |
        curl -X POST https://store.mobelite.fr/console/api_dev.php/api/upload_version \
        -H "Authorization: ${{ inputs.AUTHORIZATION }}" \
        -F "applicationToken=${{ inputs.APP_DEV_TOKEN }}" \
        -F "fileInfo=@${{ github.workspace }}/${{env.ANDROID_INFO_FILE}}n" \
        -F "file=@${{ github.workspace }}/${{env.ANDROID_BUILD_FILE}}"
      shell: bash
