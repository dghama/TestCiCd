name: 'PR Check codeBase'

runs:
  using: 'composite'
  steps:
    - name: ğŸ“¦ Restore node modules from cache
      uses: ./.github/actions/cache-restore


    - name: ğŸš‘ Run type check
      run: yarn typecheck
      shell: bash

    - name: ğŸƒâ€â™‚ï¸ Run tests with coverage
      run: yarn test --coverage --coverageReporters="text" --coverageReporters="lcov"
      shell: bash

    - name: ğŸ“¦ Upload coverage report
      uses: actions/upload-artifact@v3
      with:
        name: coverage-${{ github.sha }}
        path: ./coverage
        if-no-files-found: error
        retention-days: 1

    - name: ğŸ’¯ Comment coverage report
      uses: romeovs/lcov-reporter-action@v0.3.1
      if: github.event_name == 'pull_request'
      with:
        lcov-file: ./coverage/lcov.info
        github-token: ${{ github.token }}

    #    - name: ğŸƒâ€â™‚ï¸ Run lint
    #      run: yarn lint
    #      shell: bash
